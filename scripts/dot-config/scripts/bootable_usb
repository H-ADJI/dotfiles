#!/usr/bin/env bash

if [ "$#" -ne 2 ]; then
    echo "Usage: create_bootable_usb <path_to_iso> <device>"
    echo "Example: create_bootable_usb ubuntu_24.iso /dev/sda"
    echo "Use lsblk to list storage devices"
    exit 1
fi

iso_path="$1"
device="$2"

if [ ! -f "$iso_path" ]; then
    echo "Error: ISO file '$iso_path' does not exist."
    exit 1
fi

if [ ! -e "$device" ]; then
    echo "Error: Device '$device' does not exist."
    exit 1
fi

if mount | grep -q "$device"; then
    echo "Unmounting $device..."
    sudo umount "$device"*
fi

echo "Writing $iso_path to $device..."
sudo dd if="$iso_path" of="$device" bs=4M status=progress oflag=sync

echo "Syncing data..."
sync
echo "Ejecting $device..."
sudo eject "$device"
echo "Bootable USB created successfully!"
